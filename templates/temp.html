{% extends "base.html" %}

{% block head %}
<link href="{{ url_for('static', filename='temp.css') }}" rel="stylesheet">
{% endblock %}

{% block content %}
<h1>Calcul avec Température et Humidité</h1>
<form method="POST">
    <div class="slider-container">
        <label class="slider-label" for="temp">Température (°C)</label>
        <input type="range" name="temp" id="temp" class="slider" 
                min="27" max="80" value="{{ temp_value or 20 }}" 
                oninput="updateTempDisplay(this.value)">
        <div class="value-display" id="temp-display">{{ temp_value or 20 }}°C</div>
    </div>
    
    <div class="slider-container">
        <label class="slider-label" for="hum">Humidité (%)</label>
        <input type="range" name="hum" id="hum" class="slider" 
                min="0" max="100" value="{{ hum_value or 50 }}" 
                oninput="updateHumDisplay(this.value)">
        <div class="value-display" id="hum-display">{{ hum_value or 50 }}%</div>
    </div>

</form>

{% if result is not none %}
    <div class="result">
        <h2 id="result-display" style="{{ styleResult }}">Résultat : {{ "%.2f"|format(result) if result is number else result }}°C</h2>
    </div>
{% endif %}

<script>
    function updateTempDisplay(value) {
        document.getElementById('temp-display').textContent = value + '°C';
        calculate(); // appel auto
    }
    
    function updateHumDisplay(value) {
        document.getElementById('hum-display').textContent = value + '%';
        calculate(); // appel auto
    }

    async function calculate() {
        const temp = document.getElementById('temp').value;
        const hum = document.getElementById('hum').value;

        const response = await fetch("/calculateTemp", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ temp, hum })
        });

        const data = await response.json();

        let display = document.getElementById('result-display');
        if(!display){
            // si le h2 n’existe pas encore, on le crée dynamiquement
            const container = document.createElement("div");
            container.classList.add("result");
            display = document.createElement("h2");
            display.id = "result-display";
            container.appendChild(display);
            document.querySelector("form").after(container);
        }

        if(data.error){
            display.textContent = data.error;
            display.style = "";
        } else {
            display.textContent = "Résultat : " + data.result + "°C";
            display.style = data.styleResult;
        }
    }

    // lancer le calcul au premier chargement
    window.addEventListener("DOMContentLoaded", () => {
        calculate();
    });
</script>


{% endblock %}